{% extends 'base.html' %}

{% block title %}Written Work{% endblock %}

{% block css %}
{% endblock %}

{% block extrahead %}
{% endblock %}

{% block js %}
    <script type="text/javascript" src="//maps.google.com/maps/api/js?libraries=places&sensor=false"></script>
    <script src="{{STATIC_URL}}js/underscore-min.js"></script>
    <script src="{{STATIC_URL}}js/backbone-min.js"></script>
    <script src="{{STATIC_URL}}markerclusterer/src/markerclusterer.min.js" type="text/javascript" ></script>

    <script src="{{STATIC_URL}}js/app/imprint-detail.js"></script>

    <script type="text/javascript">
        jQuery(document).ready(function() {
            var view = new ImprintView({
                el: jQuery('div.object-detail'),
                work: {'id': '{{work.id}}'},
            });
        });
    </script>
{% endblock %}

{% block content %}
{% with work=object %}

    <div class="object-detail writtenwork">
        <div class="row">
            <div class="col-md-12">
                <h1>
                    <span class="glyphicon glyphicon-book pull-left" aria-hidden="true"></span>
                    <span class="pull-left object-title">&nbsp;{{work|truncatewords:15}}</span>                    
                    <div class="clearfix"></div>
                </h1>
                <div class="breadcrumb">THE LITERARY WORK</div>
                <dl class="dl-horizontal">
                    {% if work.actor.count > 0 %}
                        {% for actor in work.actor.all %}
                            <dt>{{actor.role}}</dt><dd>{{actor}}</dd>
                        {% endfor %}
                    {% endif %}
                
                    {% if work.notes %}
                        <dt>Notes</dt>
                        <dd>{{work.notes|safe}}</dd>
                    {% endif %}
                </dl>

                <div class="breadcrumb">
                    IMPRINTS
                </div>

                {% for imprint in work.imprint_set.all %}
                    <div class="imprint-list-item">
                        <dl class="dl-horizontal">
                            {% comment %}
                                Hard-coded links to visualizations.
                                These MUST be linked to via http:// not https:// to enable
                                a 3rd-party hosted timeline embed. This is a temporary solution
                            {% endcomment %}
                            {% ifequal work.id 27 %}
                                {% ifequal imprint.id 52 %} 
                                <a class="pull-right" href="http://footprints.ccnmtl.columbia.edu/timeline/sefer_ha-bahur/">
                                    <span class="glyphicon glyphicon-time" aria-hidden="true"></span> Timeline
                                </a>
                                {% endifequal %}
                            {% endifequal %}
                            
                            {% ifequal work.id 3 %}
                                {% ifequal imprint.id 3 %} 
                                <a class="pull-right" href="http://footprints.ccnmtl.columbia.edu/timeline/josippon/">
                                    <span class="glyphicon glyphicon-time" aria-hidden="true"></span> Timeline
                                </a>
                                {% endifequal %}
                            {% endifequal %}
                            
                            {% ifequal work.id 11 %}
                                {% ifequal imprint.id 19 %} 
                                <a class="pull-right" href="http://footprints.ccnmtl.columbia.edu/timeline/shevet_yehuda/">
                                    <span class="glyphicon glyphicon-time" aria-hidden="true"></span> Timeline
                                </a>
                                {% endifequal %}
                            {% endifequal %}

                            {% if imprint.title and imprint.title|length > 0 %}
                                <dt>Imprint Title</dt>
                                <dd>
                                    {{imprint.title}}
                                </dd>
                            {% endif %}
                            {% if imprint.date_of_publication %}
                                <dt>Publication Date</dt>
                                <dd>
                                    {{imprint.date_of_publication.edtf_format}}
                                </dd>
                            {% endif %}
                            {% if imprint.place %}
                                <dt>Imprint Location</dt>
                                <dd class="footprint-place">
                                    <span>{{imprint.place}}</span>
                                </dd>
                            {% endif %}
                            {% if imprint.language.count > 0 %}
                                <dt>Imprint Language</dt>
                                <dd>
                                    {% for language in imprint.language.all %} 
                                        {{ language.name }}{% if not forloop.last %} , {% endif %}
                                    {% endfor %}
                                </dd>
                            {% endif %}
                            {% for actor in imprint.actor.all %} 
                                <dt>{{actor.role.name}}</dt>
                                <dd>
                                    <span>{{actor.person.name}}{% if actor.alias %}  as {{actor.alias}} {% endif %}</span> 
                                </dd>
                            {% endfor %}
                            {% for ident in imprint.standardized_identifier.all %} 
                                <dt>{{ident.authority}}</dt>
                                <dd>
                                    {{ident.identifier}}
                                </dd>
                            {% endfor %}
                            {% if imprint.notes and imprint.notes|length > 0 %}
                                <dt>Imprint Notes</dt>
                                <dd>
                                    {{imprint.notes|safe}}</a>
                                </dd>
                            {% endif %}
                        </dl>
                    
                        {% if imprint.references > 0 %}
                            <div class="imprint-map" style="display: none;"></div>

                            {% if imprint.place %}
                                <div class="map-marker"
                                    style="display: none"
                                    data-latitude="{{imprint.place.latitude}}"
                                    data-longitude="{{imprint.place.longitude}}"
                                    data-title="{{imprint.display_title}}">
                                    {{imprint.description|safe}}
                                </div>
                            {% endif %}                    

                            <table class="table table-striped">
                                <caption>FOOTPRINTS</caption>
                                <tr><th>Book Copy Identifier</th><th>Footprint Date</th><th>Footprint Title</th><th>Evidence Type</th><th>Evidence Location</th></tr>
                                {% for copy in imprint.bookcopy_set.all %}
                                    {% if copy.footprint_set.count > 0 %}
                                        {% for fp in copy.footprint_set.all %}
                                            <tr>
                                            <td>
                                                {{copy.identifier}}
                                            </td>
                                            <td>{{fp.associated_date|default:""}}</td>                                                
                                            <td>
                                                <a href="/footprint/{{fp.id}}/">
                                                    {{fp.title}}
                                                </a>

                                                {% if fp.place %}
                                                    <div class="map-marker" style="display: none"
                                                        data-latitude="{{fp.place.latitude}}"
                                                        data-longitude="{{fp.place.longitude}}"
                                                        data-title="{{fp.title}}">{{fp.description}}</div>
                                                {% endif %}
                                            </td>
                                            <td>{{fp.medium}}</td>
                                            <td style="width: 30%;">{{fp.provenance}}</td>
                                            </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td>{{copy.identifier}}</td>
                                            <td colspan="4">No Footprints Recorded</td>
                                        </tr>
                                    {% endif %}
                                {% endfor %}
                            </table>
                        {% endif %}
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>
{% endwith %} 
{% endblock %}
