{% extends 'base.html' %}
{% load compress %}

{% block title %}Browse{% endblock %}

{% block js %}
    {% compress js %}
        <script src="{{STATIC_URL}}js/jquery-circle-progress/circle-progress.js"></script>
        <script src="{{STATIC_URL}}js/app/footprint-list.js"></script>
    {% endcompress %}
    
    <script type="text/javascript">
        jQuery(document).ready(function() {
            var view = new FootprintListView({
                el: jQuery(".object-browse"),
                baseUrl: "{% url 'browse-footprint-list-default' %}",
                selectedDirection: "{{direction}}",
                selectedSort: "{{selected_sort}}"
            });
        });
    </script>
{% endblock %}

{% block content %}

<div class="page-header">
  <h1>Browse Footprints</h1>
</div>

<div class="object-browse">
    {% if paginator.num_pages > 1 %}
        <div class="row tools">
            <div class="col-md-12">
                <div class="pull-right">
                    <a class="btn btn-white btn-sm {% if not page_obj.has_next %}disabled{% endif %}"
                        {% if page_obj.has_next %}  
                            href="{% url 'browse-footprint-list' selected_sort%}?direction={{direction}}&page={{page_obj.next_page_number}}"
                        {% else %}
                            href="#"
                        {% endif %}
                    >
                        Next <span class="glyphicon glyphicon-forward" aria-hidden="true"></span>
                    </a>
            
                    <a class="btn btn-white btn-sm {% if not page_obj.has_next %}disabled{% endif %}" 
                        href="{% url 'browse-footprint-list' selected_sort%}?direction={{direction}}&page={{paginator.num_pages}}">
                         Last <span class="glyphicon glyphicon-fast-forward" aria-hidden="true"></span>
                    </a>                
                </div>
                <div class="pull-right page-count">
                    Page <input data-base-url="{% url 'browse-footprint-list' selected_sort%}?direction={{direction}}&page="
                            class="form-control" type="text"
                            value="{{page_obj.number}}"> of <span class="max-page">{{paginator.num_pages}}</span>
                    <p class="error-block small">
                        Invalid page number
                    </p>
                </div>
                <div class="pull-right">
                    <a class="btn btn-white btn-sm {% if not page_obj.has_previous %}disabled{% endif %}" 
                        href="{% url 'browse-footprint-list' selected_sort%}?direction={{direction}}&page=1">
                        <span class="glyphicon glyphicon-fast-backward" aria-hidden="true"></span> First
                    </a>
                    <a class="btn btn-white btn-sm {% if not page_obj.has_previous %}disabled{% endif %}"
                        {% if page_obj.has_previous %} 
                            href="{% url 'browse-footprint-list' selected_sort%}?direction={{direction}}&page={{page_obj.previous_page_number}}"
                        {% else %}
                            href="#"
                        {% endif %}
                    >
                        <span class="glyphicon glyphicon-backward" aria-hidden="true"></span> Previous
                    </a>
                </div>
            </div>
        </div>
    {% endif %}

    <div class="table-responsive">
        <table class="table table-striped table-footprints">
            <tr>
                <th data-sort-by="ftitle" class="sortable ftitle">
                    Footprint
                </th>
                <th data-sort-by="elocation" class="sortable elocation">
                    Evidence Location
                </th>
                <th class="owners">Owners</th>
                <th data-sort-by="wtitle" class="sortable wtitle">Literary Work / Imprint</th>
                <th data-sort-by="added" class="sortable added">Added</th>
                <th data-sort-by="complete" class="sortable complete">Complete</th>
            </tr>
            {% for footprint in object_list %}
                <tr>
                    <td>
                        <div>
                            <a href="/footprint/{{footprint.id}}">
                                {{footprint.title}}
                            </a>
                        </div>
                        {% if footprint.associated_date %}
                            <div class="subtext">{{footprint.associated_date}}</div>
                        {% endif %}
                        {% if footprint.place %}
                            <div class="subtext">{{footprint.place}}</div>
                        {% endif %}</a>
                    </td>
                    <td>{{footprint.provenance}}</td>
                    <td>
                        {% for owner in footprint.owners %}
                            {{owner.display_name}}
                            {% if not forloop.last %},{% endif %}
                        {% endfor %}
                    </td>
                    <td>
                        <a href="/writtenwork/{{footprint.book_copy.imprint.work.id}}">
                            {{footprint.book_copy.imprint.work.title|default:"n/a"}}
                        </a><br />
                        {% if footprint.book_copy.imprint.title and footprint.book_copy.imprint.title|length > 0 and footprint.book_copy.imprint.work.title != footprint.book_copy.imprint.title %}
                            <div class="subtext">as {{footprint.book_copy.imprint.title}}</div>
                        {% endif %} 
                        {% if footprint.book_copy.imprint.printers.count > 0 %}
                            <div class="subtext">
                                {% for printer in footprint.book_copy.imprint.printers %}
                                    {{printer.display_name}}
                                    {% if not forloop.last %},{% endif %}
                                {% endfor %}
                            </div>
                        {% endif %}
                        <div class="subtext">
                            {% if footprint.book_copy.imprint.publication_date %}
                                {{footprint.book_copy.imprint.publication_date}}{% if footprint.book_copy.imprint.place %}, {% endif %}
                            {% endif %}
                            {% if footprint.book_copy.imprint.place %}
                                {{footprint.book_copy.imprint.place}}
                            {% endif %}
                        </div>
                    </td>
                    <td class="added">
                        {{footprint.created_at|date:"m/d/y"}}
                    </td>
                    <td class="complete">
                        <div class="progress-circle" data-value="{{footprint.percent_complete}}">
                            <strong>{{footprint.percent_complete}}<i>%</i></strong>
                        </div> 
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>
    
    {% if is_paginated %}
        <nav>
            <ul class="pager">
                {% if page_obj.has_previous %}
                    <li><a href="?page={{ page_obj.previous_page_number }}">&laquo; Previous</a></li>
                {% else %}
                    <li class="disabled"><a href="#">&laquo; Previous</a>
                {% endif %}
                {% if page_obj.has_next %}
                    <li><a href="?page={{ page_obj.next_page_number }}">Next &raquo;</a></li>
                {% else %}
                    <li class="disabled"><a href="#">Next &raquo;</a>
                {% endif %}
            </ul>
        </nav>
    {% endif %}
</div>

{% endblock %}