{% extends 'base.html' %}
{% load compress %}

{% block title %}Browse{% endblock %}

{% block js %}
    {% compress js %}
        <script src="{{STATIC_URL}}js/jquery-circle-progress/circle-progress.js"></script>
    {% endcompress %}

    <script type="text/javascript">    
        jQuery(document).ready(function() {
            jQuery('.progress-circle').each(function() {
                var pct = parseInt(jQuery(this).data('value'), 10) / 100;
                jQuery(this).circleProgress({
                    animation: false,
                    value: pct,
                    size: 50,
                    startAngle: -Math.PI/2,
                    emptyFill: '#D7D6D6',
                    fill: {
                        color: '#97421b'  //'#2e5367'
                    }
                });
            });
            
            var selected_direction = "{{direction}}";
            var selected_sort = "{{selected_sort}}";
            var base_url = "{% url 'browse-footprint-list-default' %}";

            jQuery('th.sortable').each(function() {
                var sort_by = jQuery(this).data('sort-by');
                if (sort_by === selected_sort) {
                    jQuery(this).addClass('selected').addClass(selected_direction);
                }
            });

            jQuery('th.sortable').click(function() {
                var direction = 'asc';
                var sort_by = jQuery(this).data('sort-by');
                if (sort_by === selected_sort) {
                    direction = selected_direction === 'asc' ? 'desc' : 'asc';
                }
                
                var url = base_url + sort_by + '/?direction=' + direction;
                window.location = url;
            });
        });
    </script>
{% endblock %}

{% block content %}

<div class="page-header">
  <h1>Browse Footprints</h1>
</div>

<div class="object-browse">
    <div class="row tools">
        <div class="col-sm-12">
            {% if paginator.num_pages > 1 %}
                <ul class="pagination pagination-sm pull-right">
                    {% for a_page in paginator.page_range %}
                        {% ifequal page_obj.number a_page %}
                            <li class="active"><a class="page-link disabled"
                        {% else %}
                            <li><a class="page-link"
                        {% endifequal %}
                            href="?page={{ a_page }}">{{a_page}}</a></li>
                    {% endfor %}
                </ul>
            {% endif %}
            <div class="pull-right page-count">
                {{page_obj.start_index}} - {{page_obj.end_index}} of {{paginator.count}} items
            </div>
            <div class="clearfix"></div>
        </div>
    </div>

    <div class="table-responsive">
        <table class="table table-striped table-footprints">
            <tr>
                <th data-sort-by="ftitle" class="sortable ftitle">
                    Footprint
                </th>
                <th data-sort-by="elocation" class="sortable elocation">
                    Evidence Location
                </th>
                <th class="owners">Owners</th>
                <th data-sort-by="wtitle" class="sortable wtitle">Literary Work / Imprint</th>
                <th data-sort-by="added" class="sortable added">Added</th>
                <th data-sort-by="complete" class="sortable complete">Complete</th>
            </tr>
            {% for footprint in object_list %}
                <tr>
                    <td>
                        <div>
                            <a href="/footprint/{{footprint.id}}">
                                {{footprint.title}}
                            </a>
                        </div>
                        {% if footprint.associated_date %}
                            <div class="subtext">{{footprint.associated_date}}</div>
                        {% endif %}
                        {% if footprint.place %}
                            <div class="subtext">{{footprint.place}}</div>
                        {% endif %}</a>
                    </td>
                    <td>{{footprint.provenance}}</td>
                    <td>
                        {% for owner in footprint.owners %}
                            {{owner.display_name}}
                            {% if not forloop.last %},{% endif %}
                        {% endfor %}
                    </td>
                    <td>
                        <a href="/writtenwork/{{footprint.book_copy.imprint.work.id}}">
                            {{footprint.book_copy.imprint.work.title|default:"n/a"}}
                        </a><br />
                        {% if footprint.book_copy.imprint.title and footprint.book_copy.imprint.title|length > 0 and footprint.book_copy.imprint.work.title != footprint.book_copy.imprint.title %}
                            <div class="subtext">as {{footprint.book_copy.imprint.title}}</div>
                        {% endif %} 
                        {% if footprint.book_copy.imprint.printers.count > 0 %}
                            <div class="subtext">
                                {% for printer in footprint.book_copy.imprint.printers %}
                                    {{printer.display_name}}
                                    {% if not forloop.last %},{% endif %}
                                {% endfor %}
                            </div>
                        {% endif %}
                        <div class="subtext">
                            {% if footprint.book_copy.imprint.date_of_publication %}
                                {{footprint.book_copy.imprint.date_of_publication}}{% if footprint.book_copy.imprint.place %}, {% endif %}
                            {% endif %}
                            {% if footprint.book_copy.imprint.place %}
                                {{footprint.book_copy.imprint.place}}
                            {% endif %}
                        </div>
                    </td>
                    <td class="added">
                        {{footprint.created_at|date:"m/d/y"}}
                    </td>
                    <td class="complete">
                        <div class="progress-circle" data-value="{{footprint.percent_complete}}">
                            <strong>{{footprint.percent_complete}}<i>%</i></strong>
                        </div> 
                    </td>
                </tr>
            {% endfor %}
        </table>
    </div>
    
    {% if is_paginated %}
        <nav>
            <ul class="pager">
                {% if page_obj.has_previous %}
                    <li><a href="?page={{ page_obj.previous_page_number }}">&laquo; Previous</a></li>
                {% else %}
                    <li class="disabled"><a href="#">&laquo; Previous</a>
                {% endif %}
                {% if page_obj.has_next %}
                    <li><a href="?page={{ page_obj.next_page_number }}">Next &raquo;</a></li>
                {% else %}
                    <li class="disabled"><a href="#">Next &raquo;</a>
                {% endif %}
            </ul>
        </nav>
    {% endif %}
</div>

{% endblock %}