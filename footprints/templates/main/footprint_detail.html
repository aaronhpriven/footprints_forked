{% extends 'base.html' %}
{% load compress %}

{% block title %}Detail{% endblock %}

{% block css %}
    <link href="{{STATIC_URL}}jquery-ui-1.11.2/jquery-ui.css" rel="stylesheet" />
    <link href="{{STATIC_URL}}bootstrap3-editable/css/bootstrap-editable.css" rel="stylesheet" />
{% endblock %}

{% block extrahead %}
    <link href="{{STATIC_URL}}select2-3.5.2/select2.css" rel="stylesheet" />

    <script type="text/template" id="xeditable-actor-form">
        <div class="editable-actor">
            <div class="person-name">
                <label>Person's Name</label><br />
                <input type="text" class="form-control" name="person-autocomplete" placeholder="Type in a person's name"></input>
            </div>
                    
            <div class="actor-name">
                <label>Pseudonym or Alias (if applicable)</label><br />
                <input type="text" class="form-control" name="actor-name" placeholder="Specify the person's alias"></select>
            </div>

            <div class="person-role">
                <label>Role</label><br />
                <select class="form-control" name="role" placeholder="Type in a role name">
                    {% for role in roles %}
                        <option value="{{role.id}}">{{role.name}}</option>
                    {% endfor %}
                </select>
            </div>
        </div>
    </script>
    
    <script type="text/template" id="xeditable-place-form">
        <div class="editable-place">
            <div>
                <select class="form-control" name="continent" tabindex="-1" title="Continent:">
                    <option value="" selected="selected">Select a continent</option>
                    <option value="AF">Africa</option>
                    <option value="AS">Asia</option>
                    <option value="EU">Europe</option>
                    <option value="NA">North America</option>
                    <option value="SA">South America</option>
                    <option value="OC">Oceania</option>
                    <option value="AN">Antarctica</option>
                </select>
            </div>
            <div>
                <input class="form-control" placeholder="Country" maxlength="256" name="country" type="text">
            </div>        
            <div>
                <input class="form-control" placeholder="City" maxlength="256" name="city" type="text">
            </div>
            <div>
                <input class="form-control" placeholder="Latitude" name="latitude" type="hidden"></input>
                <input class="form-control" placeholder="Longitude" name="longitude" type="hidden"></input>
                <input class="form-control" placeholder="Start typing an address..." type="text"></div>
                <div class="geoposition-map"></div>
            </div>
        </div>
    </script>    

    <script type="text-template" id="actor-display-template">
        <dt data-actor-id="<%=actor.id%>"><%=actor.role.name%></dt>
        <dd data-actor-id="<%=actor.id%>" class="border-bottom">
            <%=actor.person.name %><% if (actor.alias.length > 0) { %> as <%=actor.alias%> <% } %> 
            <div class="pull-right">
                <a href="#" class="remove-footprint-actor"
                    data-actor-id="<%=actor.id%>"
                    data-params="{csrfmiddlewaretoken:'{{csrf_token}}'}"
                    data-url="/footprint/actor/<%=footprint.id%>/remove/"
                    data-name="<%=actor.display_name%>" title="remove actor">
                    <span class="glyphicon glyphicon-remove" aria-hidden="true"></span></a>
                &nbsp;
                <a href="/person/<%=actor.person.id%>/" title="see details" class="foreign-key">
                    <span class="glyphicon glyphicon-link" aria-hidden="true"></span>
                </a>
            </div>
        </dd>
    </script>

{% endblock %}

{% block js %}
    <script src="{{STATIC_URL}}js/underscore-min.js"></script>
    <script src="{{STATIC_URL}}js/backbone-min.js"></script>
    <script type="text/javascript" src="//maps.google.com/maps/api/js?sensor=false"></script>
    <script src="{{STATIC_URL}}tinymce/tinymce.min.js"></script>

    {% compress js %}
        <script src="{{STATIC_URL}}select2-3.5.2/select2.js"></script>
        <script src="{{STATIC_URL}}jquery-ui-1.11.2/jquery-ui.js"></script>
        <script src="{{STATIC_URL}}bootstrap3-editable/js/bootstrap-editable.js"></script>
        <script src="{{STATIC_URL}}bootstrap3-editable/js/bootstrap-editable-actor.js"></script>
        <script src="{{STATIC_URL}}bootstrap3-editable/js/bootstrap-editable-place.js"></script>
        <script src="{{STATIC_URL}}js/app/editFootprint.js"></script>
    {% endcompress %}

    <script type="text/javascript">
        jQuery(document).ready(function() {
            var editView = new EditFootprintView({
                el: jQuery("div.object-detail.footprint"),
                languages: [{% for language in languages %}
                            {value: '{{language.id}}', text: "{{language.name}}"}{% if not forloop.last %},{% endif %}
                            {% endfor %}],
                mediums:  [{% for medium in footprint.MEDIUM_CHOICES %}
                           {value: '{{medium}}', text: "{{medium}}"}{% if not forloop.last %},{% endif %}
                           {% endfor %}],
            });
        });
    </script>

{% endblock %}

{% block content %}
    {% with footprint=object book=object.book_copy imprint=object.book_copy.imprint work=object.book_copy.imprint.work %}
    <div class="object-detail footprint">
        {% csrf_token %}
        <div class="row">
            <div class="col-md-8">
                <div class="breadcrumb">FOOTPRINT</div>
                <h2>
                    <img class="pull-left" src="{{STATIC_URL}}img/footprint.png" />
                    <span class="pull-left object-title" data-name='display-title'>{{footprint.display_title}}</span>
                    <div class="clearfix"></div>
                </h2>
                {% for media in footprint.digital_object.all %}
                    <img src="{{media.file.url}}"></img>
                {% endfor %}
                {% if footprint.narrative %}
                    <blockquote class="blockquote">
                    {{footprint.narrative}}
                    </blockquote>
                {% endif %}
                <br />
                <div class="evidence-container">
                    <dl class="dl-horizontal">
                        <div class="description-list" {% if not footprint.associated_date %}style="display: none"{% endif %}>
                            <dt>Footprint Date</dt>
                            <dd class="border-bottom">
                                <a href="#" class="{% if editable %}editable editable-date{% else %}readonly{% endif %}"
                                    data-attribute-name="associated_date" data-name="edtf_format"
                                    data-type="text" data-pk="{{footprint.associated_date.id}}"
                                    data-params="{csrfmiddlewaretoken:'{{csrf_token}}'}"
                                    {% if footprint.associated_date.id %}
                                        data-url="/api/edtf/{{footprint.associated_date.id}}/"
                                    {% else %}
                                        data-url="/api/edtf/"
                                    {% endif %}>{{footprint.associated_date}}</a>
                            </dd>
                        </div>
                        {% if footprint.place %}
                            <dt>Footprint Place</dt>
                            <dd class="border-bottom">
                                <!-- a href="#" class="{% if editable %}editable{% else %}readonly{% endif %}"
                                    data-attribute-name="place" data-name="place"
                                    data-type="location" data-pk="{{footprint.id}}"
                                    data-params="{csrfmiddlewaretoken:'{{csrf_token}}'}" 
                                    data-url="/api/footprint/{{footprint.id}}/"></a-->
                                    {{footprint.place}}
                            </dd>
                        {% endif %}
                        
                        <div class="description-list" {% if footprint.language.count < 1 %}style="display: none"{% endif %}>
                            <dt>Footprint Language</dt>
                            <dd class="border-bottom">
                                <a href="#" class="{% if editable %}editable-language{% else %}readonly{% endif %}"
                                    data-attribute-name="language" data-name="language"
                                    data-type="select2" data-pk="{{footprint.id}}"
                                    data-value="[{% for language in footprint.language.all %}{{language.id}}{% if not forloop.last %},{% endif %}{% endfor %}]"
                                    data-params="{csrfmiddlewaretoken:'{{csrf_token}}'}"
                                    data-url="/api/footprint/{{footprint.id}}/">
                                    {% for language in footprint.language.all %}
                                        {{language.name}}{% if not forloop.last %}, {% endif %}
                                    {% endfor %}
                                </a>
                            </dd>
                        </div>
                        {% ifnotequal footprint.title footprint.display_title %}
                        <div class="description-list" {% if not footprint.title %}style="display: none"{% endif %}>
                            <dt>Title of the work<br />as shown in footprint</dt>
                            <dd class="border-bottom">
                                <a href="#" class="{% if editable %}editable{% else %}readonly{% endif %}"
                                    data-attribute-name="title" data-name="title"
                                    data-type="text" data-pk="{{footprint.id}}"
                                    data-params="{csrfmiddlewaretoken:'{{csrf_token}}'}" 
                                    data-url="/api/footprint/{{footprint.id}}/">{{footprint.title}}</a>
                            </dd>
                        </div>
                        {% endifnotequal %}
                        
                        <div class="actor-list">
                            {% for actor in footprint.actor.all %}
                                <dt data-actor-id="{{actor.id}}">{{actor.role.name}}</dt>
                                <dd data-actor-id="{{actor.id}}" class="border-bottom">
                                    {{actor.person.name}}{% if actor.alias %} as {{actor.alias}} {% endif %} 
                                    <div class="pull-right">
                                        {% if editable %}
                                        <a href="#" class="remove-footprint-actor"
                                            data-actor-id="{{actor.id}}"
                                            data-params="{csrfmiddlewaretoken:'{{csrf_token}}'}" 
                                            data-url="/footprint/actor/{{footprint.id}}/remove/"
                                            data-name="{{actor.display_name}}"
                                            title="remove actor">
                                            <span class="glyphicon glyphicon-remove" aria-hidden="true"></span></a>
                                        {% endif %}
                                        &nbsp;
                                        <a href="/person/{{actor.person.id}}/" title="see details" class="foreign-key">
                                            <span class="glyphicon glyphicon-link" aria-hidden="true"></span>
                                        </a>
                                    </div>
                                </dd>
                            {% endfor %}
                       </div>
                    </dl>
                    <br />
                    <dl class="dl-horizontal">
                        <dt>Evidence Type</dt>
                        <dd class="border-bottom">
                            <a href="#" class="{% if editable %}editable-medium{% else %}readonly{% endif %}"
                                data-attribute-name="medium" data-name="medium"
                                data-type="select2" data-pk="{{footprint.id}}"
                                data-value="{{footprint.medium}}"
                                data-params="{csrfmiddlewaretoken:'{{csrf_token}}'}"
                                data-url="/api/footprint/{{footprint.id}}/">{{footprint.medium}}
                            </a>
                        </dd>
                        <div class="description-list"
                            {% if footprint.medium_description == None or footprint.medium_description == ''%}style="display: none"{% endif %}>
                            <dt>Evidence Description</dt>
                            <dd class="border-bottom">
                                <a href="#" class="{% if editable %}editable{% else %}readonly{% endif %}"
                                    data-attribute-name="medium_description" data-name="medium_description"
                                    data-type="text" data-pk="{{footprint.id}}"
                                    data-params="{csrfmiddlewaretoken:'{{csrf_token}}'}" 
                                    data-url="/api/footprint/{{footprint.id}}/">{{footprint.medium_description}}</a>
                            </dd>
                        </div>
                        <dt>Evidence Location</dt>
                        <dd class="border-bottom">
                            <a href="#" class="{% if editable %}editable{% else %}readonly{% endif %}"
                                data-attribute-name="provenance" data-name="provenance"
                                data-type="text" data-pk="{{footprint.id}}"
                                data-params="{csrfmiddlewaretoken:'{{csrf_token}}'}" 
                                data-url="/api/footprint/{{footprint.id}}/">{{footprint.provenance}}</a>
                        </dd>
                        <div class="description-list" {% if footprint.call_number == None or footprint.call_number == '' %}style="display: none"{% endif %}>
                            <dt>Evidence Call Number</dt>
                            <dd class="border-bottom">
                                <a href="#" class="{% if editable %}editable{% else %}readonly{% endif %}"
                                    data-attribute-name="call_number"  data-name="call_number"
                                    data-type="text" data-pk="{{footprint.id}}"
                                    data-params="{csrfmiddlewaretoken:'{{csrf_token}}'}" 
                                    data-url="/api/footprint/{{footprint.id}}/">{{footprint.call_number}}</a>
                            </dd>
                        </div>                        
                        <div class="description-list" {% if not footprint.notes %}style="display: none"{% endif %}>
                            <dt>Notes</dt>
                            <dd class="border-bottom">
                                <a href="#" class="{% if editable %}editable{% else %}readonly{% endif %}"
                                    data-attribute-name="notes" data-name="notes"
                                    data-type="textarea" data-pk="{{footprint.id}}"
                                    data-params="{csrfmiddlewaretoken:'{{csrf_token}}'}" 
                                    data-url="/api/footprint/{{footprint.id}}/">{{footprint.notes|safe}}</a>
                            </dd>
                        </div>
                    </dl>
                    {% if editable %}
                    <dl class="dl-horizontal">
                        <dt>Do you know...</dt>
                        <dd>  
                            <ul class="additional-questions">
                                {% if not footprint.place %}
                                    <li>
                                        <span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span>
                                        <a href="#" class="{% if editable %}editable-place{% endif %} do-you-know persistant" data-name="place"
                                            data-type="place" data-pk="{{footprint.id}}" data-value=""
                                            data-params="{csrfmiddlewaretoken:'{{csrf_token}}'}" 
                                            data-url="/footprint/place/{{footprint.id}}/add/">the place where the footprint occurred?</a>
                                    </li>
                                {% endif %}
                                {% if not footprint.associated_date %}
                                    <li><span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span>
                                    <a href="#" class="{% if editable %}editable editable-date{% endif %} do-you-know persistant"
                                        data-name="associated_date"
                                        data-type="text" data-pk="{{footprint.id}}"
                                        data-params="{csrfmiddlewaretoken:'{{csrf_token}}'}" data-value=""
                                        data-url="/footprint/date/{{footprint.id}}/">the date when the footprint occurred?</a>
                                    </li>
                                {% endif %}
                                {% if footprint.language.count < 1 %}
                                    <li><span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span>
                                        <a href="#" class="{% if editable %}editable-language{% endif %} do-you-know persistant"
                                            data-name="language"
                                            data-type="select2" data-pk="{{footprint.id}}" data-value=""
                                            data-params="{csrfmiddlewaretoken:'{{csrf_token}}'}" 
                                            data-url="/api/footprint/{{footprint.id}}/">the language(s) of the footprint?</a>
                                    </li>
                                {% endif %}

                                <li class="fixed"><span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span>
                                    <a href="#" class="{% if editable %}editable-actor{% endif %} do-you-know persistant" data-name="actor"
                                        data-type="actor" data-pk="{{footprint.id}}" data-value=""
                                        data-params="{csrfmiddlewaretoken:'{{csrf_token}}'}" 
                                        data-url="/footprint/actor/{{footprint.id}}/add/">people related to this footprint, e.g. sellers, owners, curators?</a>
                                </li>

                                {% if footprint.medium_description == None or footprint.medium_description == '' %}
                                    <li><span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span>
                                        <a href="#" class="{% if editable %}editable{% endif %} do-you-know persistant"
                                            data-name="medium_description" data-value=""                                         
                                            data-type="text" data-pk="{{footprint.id}}"
                                            data-params="{csrfmiddlewaretoken:'{{csrf_token}}'}"
                                            data-url="/api/footprint/{{footprint.id}}/">details about the evidence type, e.g. a catalog title?</a>
                                    </li>
                                {% endif %}

                                {% if footprint.call_number == None or footprint.call_number == '' %}
                                    <li><span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span>
                                    <a href="#" class="{% if editable %}editable{% endif %} do-you-know persistant" data-name="call_number"
                                        data-type="text" data-pk="{{footprint.id}}"
                                        data-params="{csrfmiddlewaretoken:'{{csrf_token}}'}" 
                                        data-value=""
                                        data-url="/api/footprint/{{footprint.id}}/">the call number of the evidence?</a>
                                    </li>
                                {% endif %}
                                {% if not footprint.notes %}
                                    <li><span class="glyphicon glyphicon-question-sign" aria-hidden="true"></span>
                                        <a href="#" class="editable do-you-know persistant" data-name="notes"
                                           data-type="textarea" data-pk="{{footprint.id}}" data-value=""
                                           data-params="{csrfmiddlewaretoken:'{{csrf_token}}'}"
                                           data-url="/api/footprint/{{footprint.id}}/">any additional notes, clarifications, deductions or oddities?</a>
                                    </li>
                                {% endif %}
                            </ul>
                        </dd>
                    </dl>
                    {% endif %}
                </div>
                
                {% if book.percent_complete > 0 or imprint.percent_complete > 0 %}
                    <dl class="dl-horizontal">
                        {% if work.title == '' %}
                            <h3>More about the imprint</h3>
                        {% else %}
                            <h3>More about {{work.title}}</h3>
                        {% endif %}
                        {% if work %}
                            {% for actor in work.actor.all %}
                                <dt>{{actor.role.name}}</dt><dd class="border-bottom"><a href="/person/{{actor.person.id}}/">{{actor}}</a></dd>
                            {% endfor %}
                            {% if work.notes %}
                                <dt>Notes</dt><dd class="border-bottom">{{work.notes}}</dd>
                            {% endif %}
                        {% endif %}
                                                    
                        {% if book.percent_complete > 0 %}

                        {% endif %}
    
                        {% if imprint.percent_complete > 0 %}
                            {% if imprint.title %}
                                <dt>Imprint Title</dt><dd class="border-bottom">{{imprint.title}}</dd>
                            {% endif %}
                            {% if imprint.language.count > 0 %}
                                <dt>Publication Language</dt>
                                <dd class="border-bottom">
                                    {% for language in imprint.language.all %}
                                        {{language.name}}
                                    {% endfor %}
                                </dd>
                            {% endif %}
                            {% if imprint.date_of_publication %}
                                <dt>Publication Date</dt><dd class="border-bottom">{{imprint.date_of_publication}}</dd>
                            {% endif %}
                            {% if imprint.place %}
                                <dt>Publication Place</dt><dd class="border-bottom"><a href="/place/{{imprint.place.id}}/">{{imprint.place}}</a></dd>
                            {% endif %}
                            {% if imprint.actor.count > 0 %}
                                {% for actor in imprint.actor.all %}
                                    {% if not actor.role.is_author %}
                                        <dt>{{actor.role.name}}</dt>
                                        <dd class="border-bottom"><a href="/person/{{actor.person.id}}/">{{actor}}</a></dd>
                                    {% endif %}
                                {% endfor %}
                            {% endif %}
                        {% endif %}
                    </dl>
                {% endif %}
            </div>
            <div class="col-md-4">
                <div class="sidebar-box">
                    {% with complete=footprint.percent_complete %}
                        <h4>Record Progress</h4>
                        <div>
                            <div class="progress pull-left">
                                <div class="progress-bar" role="progressbar"
                                    aria-valuenow="{{complete}}" aria-valuemin="0"
                                    aria-valuemax="100" style="width: {{complete}}%;">
                                </div>
                            </div>
                            <div class="progress-report pull-right">{{complete}}% complete</div>
                        </div>
                        <div class="clearfix"></div>
                        {% if editable %}
                        <div>
                            <strong>Do you know something important?</strong>
                            <p>Praesent fringilla sit amet dolor at congue. Fusce pretium neque rutrum luctus dictum.</p>
                            <button class="btn btn-sm btn-primary pull-right">Save</button>&nbsp;
                            <button class="btn btn-sm btn-default pull-right" style="margin-right: 6px;">Skip</button>
                        </div>
                        {% endif %}
                    {% endwith %}
                    <div class="clearfix"></div>
                </div>

                {% if editable %}
                <div class="sidebar-box">
                    <h4>Can you connect this record?</h4>
                    <p>Further describe your footprint by connecting similar records.</p>
                    {% for record in records %}
                        {{record}}
                    {% endfor %}
                </div>
                {% endif %}
            </div>
        </div>
        
        <div class="modal" id="confirm-modal" tabindex="-1" role="dialog" aria-labelledby="Confirm" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title">Confirm</h4>
                </div>
                <div class="modal-body"></div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-default" data-dismiss="modal">No</button>
                    <button type="button" class="btn btn-primary btn-confirm">Yes</button>
                </div>
            </div>
        </div>
    </div>           
    </div>
{% endwith %} 
{% endblock %}
